# Dockerfile

# 1) Use a pinned base image with Ruby 3.2
FROM ruby:3.2.2-bullseye

# 2) Install necessary Linux packages for building gems
#    libpq-dev is needed for 'pg' gem (PostgreSQL)
#    nodejs is typically needed if Rails compiles JS (but for an API-only app, you might skip it)
RUN apt-get update -qq && apt-get install -y build-essential libpq-dev nodejs

# 3) Set the working directory inside the container
WORKDIR /app

# 4) Copy the Gemfile and Gemfile.lock first. This leverages Docker layer caching
COPY Gemfile Gemfile.lock ./

# 5) Configure Bundler to install gems in vendor/bundle
RUN bundle config set --local path 'vendor/bundle'
RUN bundle install

# 6) Now copy the rest of the source code
COPY . .

# 7) Expose port 3000 (where Puma or Rails server will run by default)
EXPOSE 3000

# 8) Default command to run Rails server
CMD ["bash", "-c", "bundle exec rails server -b 0.0.0.0 -p 3000"]
